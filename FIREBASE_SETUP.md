# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase –¥–ª—è —Ç–µ–Ω–Ω–∏—Å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ö–æ–Ω—Ñ–∏–≥ Firebase –±–µ—Ä—ë—Ç—Å—è –∏–∑ env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (—Å–º. `src/lib/firebase.ts`). –õ–æ–∫–∞–ª—å–Ω–æ:

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env`:
   ```bash
   cp .env.example .env
   ```
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ [Firebase Console](https://console.firebase.google.com/) ‚Üí **Project settings** ‚Üí **Your apps** (web app):
   - `VITE_FIREBASE_API_KEY`
   - `VITE_FIREBASE_AUTH_DOMAIN`
   - `VITE_FIREBASE_PROJECT_ID`
   - `VITE_FIREBASE_STORAGE_BUCKET`
   - `VITE_FIREBASE_MESSAGING_SENDER_ID`
   - `VITE_FIREBASE_APP_ID`

–§–∞–π–ª `.env` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è. –î–ª—è GitHub Actions –¥–µ–ø–ª–æ—è —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏: –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions** ‚Üí **Variables** (–∏–ª–∏ **Secrets**), –∑–∞—Ç–µ–º –≤ workflow –ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ –≤ `env` –¥–ª—è —à–∞–≥–∞ Build.

## Firebase Hosting ‚Äî –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ß—Ç–æ–±—ã –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç:

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** (–≤–∫–ª—é—á–∞—è Firebase CLI):
   ```bash
   pnpm install
   ```

2. **–í–æ–π–¥–∏—Ç–µ –≤ Firebase** (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –≤–æ—à–ª–∏):
   ```bash
   npx firebase login
   ```

3. **–°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç** –≤ [Firebase Console](https://console.firebase.google.com/). –ó–∞–ø–æ–º–Ω–∏—Ç–µ **Project ID**.

4. **–£–∫–∞–∂–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç** –≤ –ø—Ä–æ–µ–∫—Ç–µ:
   - –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.firebaserc` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ `your-firebase-project-id` –Ω–∞ –≤–∞—à Project ID, **–∏–ª–∏**
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: `npx firebase use your-firebase-project-id`

5. **–°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–¥–µ–ø–ª–æ–π—Ç–µ**:
   ```bash
   pnpm deploy
   ```
   –õ–∏–±–æ –ø–æ —à–∞–≥–∞–º: `pnpm build`, –∑–∞—Ç–µ–º `pnpm run deploy:hosting`.

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç –≤–∏–¥–∞ `https://your-project-id.web.app`.

### –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions (Stage + Prod)

- **Stage:** –ø—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É **`dev`** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **environment ¬´dev¬ª** ‚Üí –¥–µ–ø–ª–æ–π –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π Firebase-–ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–∞–π—Ç **play-today-miniapp-dev**. URL: `https://play-today-miniapp-dev.web.app`.
- **Prod:** –ø—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É **`main`** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **environment ¬´prod¬ª** ‚Üí –¥–µ–ø–ª–æ–π –≤ –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–∞–π—Ç **play-today-miniapp** (`https://play-today-miniapp.web.app`).

–°–µ–∫—Ä–µ—Ç—ã –∑–∞–¥–∞—é—Ç—Å—è –≤ **GitHub Environments** (Settings ‚Üí Environments ‚Üí dev / prod). –í –∫–∞–∂–¥–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ ‚Äî **–æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –∏–º–µ–Ω–∞** —Å–µ–∫—Ä–µ—Ç–æ–≤, –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–∑–Ω—ã–µ (stage vs prod).

**–í environment ¬´dev¬ª** –¥–æ–±–∞–≤—å—Ç–µ:
- `VITE_FIREBASE_PROJECT_ID` ‚Äî Project ID –≤–∞—à–µ–≥–æ **stage** Firebase-–ø—Ä–æ–µ–∫—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –¥–ª—è –¥–µ–ø–ª–æ—è, –∏ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ).
- `FIREBASE_SERVICE_ACCOUNT` ‚Äî JSON –∫–ª—é—á —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ **stage**-–ø—Ä–æ–µ–∫—Ç–∞ (Project settings ‚Üí Service accounts ‚Üí Generate new private key).
- `VITE_FIREBASE_API_KEY`, `VITE_FIREBASE_AUTH_DOMAIN`, `VITE_FIREBASE_STORAGE_BUCKET`, `VITE_FIREBASE_MESSAGING_SENDER_ID`, `VITE_FIREBASE_APP_ID` ‚Äî –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ **stage**-–ø—Ä–æ–µ–∫—Ç–µ (Project settings ‚Üí Your apps).

**–í environment ¬´prod¬ª** –¥–æ–±–∞–≤—å—Ç–µ:
- `VITE_FIREBASE_PROJECT_ID` ‚Äî `play-today-479819`.
- `FIREBASE_SERVICE_ACCOUNT` ‚Äî JSON –∫–ª—é—á —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ **prod**-–ø—Ä–æ–µ–∫—Ç–∞.
- `VITE_FIREBASE_API_KEY`, `VITE_FIREBASE_AUTH_DOMAIN`, `VITE_FIREBASE_STORAGE_BUCKET`, `VITE_FIREBASE_MESSAGING_SENDER_ID`, `VITE_FIREBASE_APP_ID` ‚Äî –∫–æ–Ω—Ñ–∏–≥ **prod**-–≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–í workflow –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `GITHUB_TOKEN` (–≤—ã–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏). Stage –∏ prod –æ–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **target: miniapp** –∏ –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É; —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–æ–µ–∫—Ç –∏ —Å–µ–∫—Ä–µ—Ç—ã (dev/prod environment).

**–ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∞–π—Ç–æ–≤ Hosting** –∏ –Ω—É–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ –Ω–æ–≤—ã–π —Å–∞–π—Ç, –∞ –Ω–µ –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π:
1. –í [Firebase Console](https://console.firebase.google.com/) ‚Üí **Hosting** –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω—É–∂–Ω—ã–π —Å–∞–π—Ç –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ **Site ID** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `play-today-miniapp`).
2. –í —Ñ–∞–π–ª–µ `.firebaserc` –∑–∞–º–µ–Ω–∏—Ç–µ `YOUR_NEW_SITE_ID` –Ω–∞ —ç—Ç–æ—Ç Site ID (–≤ –±–ª–æ–∫–µ `targets` ‚Üí `hosting` ‚Üí `miniapp`).
3. –õ–∏–±–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑: `npx firebase target:apply hosting miniapp –í–ê–®_SITE_ID` ‚Äî —Ç–æ–≥–¥–∞ `.firebaserc` –æ–±–Ω–æ–≤–∏—Ç—Å—è —Å–∞–º.

–ò–º—è target (`miniapp`) –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –∏ –≤ `firebase.json`, –∏ –≤ `.github/workflows/deploy.yml` (–ø–∞—Ä–∞–º–µ—Ç—Ä `target`), –∏ –≤ `.firebaserc`, —á—Ç–æ–±—ã –æ–Ω–∏ —Å–æ–≤–ø–∞–¥–∞–ª–∏.

**–û—à–∏–±–∫–∞ ¬´Hosting target miniapp is linked to multiple sites¬ª:** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
npx firebase target:clear hosting miniapp
npx firebase target:apply hosting miniapp play-today-miniapp
```
(–ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π Site ID –≤–º–µ—Å—Ç–æ `play-today-miniapp`, –µ—Å–ª–∏ –æ–Ω –¥—Ä—É–≥–æ–π), –∑–∞—Ç–µ–º –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `.firebaserc`.

**–û—à–∏–±–∫–∞ 404 ¬´Requested entity was not found¬ª –¥–ª—è —Å–∞–π—Ç–∞ `play-today-miniapp`:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–∞–π—Ç Hosting –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω: [Firebase Console](https://console.firebase.google.com/) ‚Üí **Hosting** ‚Üí –≤–≤–µ—Ä—Ö—É –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –º–µ–∂–¥—É —Å–∞–π—Ç–∞–º–∏ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ **Site ID** (–∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞).
- –õ–∏–±–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ (–ø–æ–¥ —Å–≤–æ–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º): `npx firebase hosting:sites:list` ‚Äî –≤ –≤—ã–≤–æ–¥–µ –±—É–¥—É—Ç –≤—Å–µ Site ID –ø—Ä–æ–µ–∫—Ç–∞. –£ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ —Å–∞–π—Ç–∞ ID –æ–±—ã—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å Project ID; —É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ‚Äî —Ç–æ—Ç, —á—Ç–æ –≤—ã –∑–∞–¥–∞–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏.
- –í `.firebaserc` –≤ `targets ‚Üí ‚Ä¶ ‚Üí hosting ‚Üí miniapp` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—Ä–æ–≤–Ω–æ —ç—Ç–æ—Ç** Site ID. –ï—Å–ª–∏ —Å–∞–π—Ç –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω: Hosting ‚Üí ¬´Add another site¬ª, –∑–∞–¥–∞–π—Ç–µ ID (–Ω–∞–ø—Ä–∏–º–µ—Ä `play-today-miniapp`), –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç–µ `.firebaserc` –∏ –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ.

**–û—à–∏–±–∫–∞ 403 / ¬´Caller does not have required permission¬ª / ¬´serviceusage.serviceUsageConsumer¬ª:**
- –°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (–∫–ª—é—á –∏–∑ —Å–µ–∫—Ä–µ—Ç–∞ `FIREBASE_SERVICE_ACCOUNT`) –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ Hosting. –í [Google Cloud Console](https://console.cloud.google.com/) –≤—ã–±–µ—Ä–∏—Ç–µ **–ø—Ä–æ–µ–∫—Ç** (stage –∏–ª–∏ prod), –∑–∞—Ç–µ–º **IAM & Admin** ‚Üí **IAM** ‚Üí –Ω–∞–π–¥–∏—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (–ø–æ email –∏–∑ JSON –∫–ª—é—á–∞) –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ä–æ–ª–∏:
  - **Firebase Hosting Admin**,
  - **Service Usage Consumer** (`roles/serviceusage.serviceUsageConsumer`) ‚Äî —á–∞—Å—Ç–æ –Ω—É–∂–Ω–∞ –¥–ª—è –¥–µ–ø–ª–æ—è –∏–∑ CI.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ –≤–∫–ª—é—á—ë–Ω **Firebase Hosting API**: [APIs & Services](https://console.cloud.google.com/apis/library) ‚Üí ¬´Firebase Hosting API¬ª ‚Üí Enable.
- –î–ª—è **stage** (–≤–µ—Ç–∫–∞ dev) –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –≤ **stage** Firebase-–ø—Ä–æ–µ–∫—Ç–µ, –¥–ª—è **prod** ‚Äî –≤ prod-–ø—Ä–æ–µ–∫—Ç–µ.

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–∂–¥—ã–π `git push` –≤ `main` –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–±–æ—Ä–∫—É –∏ –¥–µ–ø–ª–æ–π –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–∞–π—Ç.

---

## –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "Missing or insufficient permissions"

–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É `Missing or insufficient permissions`, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Firestore –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Rules** (–≤–∫–ª–∞–¥–∫–∞ "–ü—Ä–∞–≤–∏–ª–∞")
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–∞–≤–∏–ª –∏–∑ —Å–µ–∫—Ü–∏–∏ –Ω–∏–∂–µ
5. –ù–∞–∂–º–∏—Ç–µ **Publish** (–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å)
6. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç 1 –∏–ª–∏ –í–∞—Ä–∏–∞–Ω—Ç 2 (–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞).**

---

## –ü—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Firestore

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∏–∂–µ –≤ Firebase Console ‚Üí Firestore Database ‚Üí Rules:

### ‚≠ê –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–∫—Ä—ã—Ç–æ–µ —á—Ç–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```javascript
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // –û—Ç–∫—Ä—ã—Ç–æ–µ —á—Ç–µ–Ω–∏–µ –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ groupTrainings
    match /groupTrainings/{document=**} {
      allow read: if true;
      allow write: if false;
    }
    
    // –û—Ç–∫—Ä—ã—Ç–æ–µ —á—Ç–µ–Ω–∏–µ –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ users
    match /users/{document=**} {
      allow read: if true;
      allow write: if false;
    }
  }
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø (–¢–û–õ–¨–ö–û –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!)

```javascript
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
```

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –í–°–ï–ú –∫–æ–ª–ª–µ–∫—Ü–∏—è–º. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–¥–∞–∫—à–Ω-–ø—Ä–∞–≤–∏–ª–∞ (–¥–ª—è production)

```javascript
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // –ö–æ–ª–ª–µ–∫—Ü–∏—è groupTrainings
    match /groupTrainings/{trainingId} {
      // –ß—Ç–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º
      allow read: if true;
      
      // –ó–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
                               request.auth.uid == resource.data.userId;
    }
    
    // –ö–æ–ª–ª–µ–∫—Ü–∏—è users
    match /users/{userId} {
      // –ß—Ç–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π —Ç—Ä–µ–Ω–µ—Ä–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º
      allow read: if true;
      
      // –ó–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è
      allow create, update, delete: if request.auth != null && 
                                       request.auth.uid == userId;
    }
  }
}
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Firestore

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è `groupTrainings` —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```javascript
{
  userId: 123,                    // number
  trainerName: "–°–æ—Ñ—å—è –ö–∞—Ä–±—ã—à–µ–≤–∞", // string
  courtName: "–¢–ö –ö–æ–ª–æ–º–µ–Ω—Å–∫–∏–π",    // string
  dateTime: "27.02 19:00",        // string –≤ —Ñ–æ—Ä–º–∞—Ç–µ "–î–î.–ú–ú –ß–ß:–ú–ú"
  isRecurring: true,              // boolean (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è –∑–∞–Ω—è—Ç–∏–µ
  duration: 1.5,                  // number (—á–∞—Å—ã: 1, 1.5, 2)
  groupSize: "3-4",               // string: "3-4" –∏–ª–∏ "5-6" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  level: "beginner",              // string: "beginner", "beginner_plus", "intermediate", "advanced", "advanced_plus"
  priceSingle: 2950,              // number
  contact: "@sophya_tennis",      // string
  createdAt: Timestamp,           // Firestore Timestamp
  isActive: true                  // boolean
}
```

### –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–∞–Ω—è—Ç–∏—è (`isRecurring`)

–ï—Å–ª–∏ `isRecurring: true`, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç **–¥–≤–µ –±–ª–∏–∂–∞–π—à–∏–µ –¥–∞—Ç—ã** –∑–∞–Ω—è—Ç–∏—è:

**–ü—Ä–∏–º–µ—Ä:**
- –¢—Ä–µ–Ω–µ—Ä –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª –∑–∞–Ω—è—Ç–∏–µ: `dateTime: "02.03 19:00"` (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
- –£—Å—Ç–∞–Ω–æ–≤–∏–ª: `isRecurring: true`
- –°–µ–≥–æ–¥–Ω—è: 15.03.2026 (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∂–µ—Ç**:
  - –ü–µ—Ä–≤–∞—è –¥–∞—Ç–∞: "16.03 19:00" (–±–ª–∏–∂–∞–π—à–∏–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
  - –í—Ç–æ—Ä–∞—è –¥–∞—Ç–∞: "23.03 19:00" (—Å–ª–µ–¥—É—é—â–∏–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, +7 –¥–Ω–µ–π) - —Å–µ—Ä—ã–º —Ü–≤–µ—Ç–æ–º

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ:**
```
üìÖ –ü–Ω 16.03
   –ü–Ω 23.03  ‚Üê —Å–µ—Ä—ã–º —Ü–≤–µ—Ç–æ–º
```

**–õ–æ–≥–∏–∫–∞:**
1. –ò–∑ –∏—Å—Ö–æ–¥–Ω–æ–π –¥–∞—Ç—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (–≤ –ø—Ä–∏–º–µ—Ä–µ - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
2. –ò—â—É—Ç—Å—è –¥–≤–∞ –±–ª–∏–∂–∞–π—à–∏—Ö —Å–ª–µ–¥—É—é—â–∏—Ö –¥–Ω—è —Å —Ç–∞–∫–∏–º –∂–µ –¥–Ω—ë–º –Ω–µ–¥–µ–ª–∏
3. –í—Ä–µ–º—è –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ, –∫–∞–∫ –≤ –∏—Å—Ö–æ–¥–Ω–æ–π –¥–∞—Ç–µ
4. –í Firestore –¥–∞—Ç–∞ –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç—Å—è - —Ä–∞—Å—á—ë—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

## –ú–∞–ø–ø–∏–Ω–≥ —É—Ä–æ–≤–Ω–µ–π

| Firestore | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
|-----------|------------|
| "beginner" | –ù–∞—á–∏–Ω–∞—é—â–∏–π 0-1 |
| "beginner_plus" | –ù–∞—á–∏–Ω–∞—é—â–∏–π+ 1.5-2 |
| "intermediate" | –°—Ä–µ–¥–Ω–∏–π 2.5-3 |
| "advanced" | –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π 3-3.5 |
| "advanced_plus" | –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π+ 4+ |

## –ö–æ–ª–ª–µ–∫—Ü–∏—è `users` - –ü—Ä–æ—Ñ–∏–ª–∏ —Ç—Ä–µ–Ω–µ—Ä–æ–≤

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–∞–∫–∂–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏ —Ç—Ä–µ–Ω–µ—Ä–æ–≤ –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `users`. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Ç—Ä–µ–Ω–µ—Ä–∞:

```javascript
{
  // –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  name: "–°–æ—Ñ—å—è",                      // string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  phone: "+7 (999) 123-45-67",        // string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  city: "–ú–æ—Å–∫–≤–∞",                     // string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  level: "beginner",                  // string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  districts: ["–•–∞–º–æ–≤–Ω–∏–∫–∏", "–¶–ê–û"],    // string[] (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  favorites: ["court123", "court456"],// string[] (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  
  // –ü–æ–ª—è —Ç—Ä–µ–Ω–µ—Ä–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è —Ç—Ä–µ–Ω–µ—Ä–æ–≤)
  isCoach: true,                      // boolean - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è —Ç—Ä–µ–Ω–µ—Ä–æ–≤
  coachName: "–°–æ—Ñ—å—è –ö–∞—Ä–±—ã—à–µ–≤–∞",       // string - –§–ò–û —Ç—Ä–µ–Ω–µ—Ä–∞
  coachDistricts: ["–¶–ê–û", "–ó–ê–û"],     // string[] - —Ä–∞–π–æ–Ω—ã —Ä–∞–±–æ—Ç—ã
  coachPriceIndividual: 4000,         // number - —Ü–µ–Ω–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
  coachPriceSplit: 3000,              // number - —Ü–µ–Ω–∞ —Å–ø–ª–∏—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
  coachPriceGroup: 2500,              // number - —Ü–µ–Ω–∞ –≥—Ä—É–ø–ø–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
  coachAvailableDays: ["–ü–Ω", "–°—Ä", "–ü—Ç"], // string[] - –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏
  coachMedia: [                       // CoachMediaItem[] - —Ñ–æ—Ç–æ –∏ –≤–∏–¥–µ–æ
    {
      type: "photo",
      fileId: "AgACAgIAAxkBAAI...",  // Telegram file_id
      publicUrl: "https://storage.googleapis.com/.../photo.jpg",
      uploadedAt: "2024-02-22T10:30:00.000Z"
    },
    {
      type: "video",
      fileId: "BAACAgIAAxkBAAI...",  // Telegram file_id
      publicUrl: "https://storage.googleapis.com/.../video.mp4",
      uploadedAt: "2024-02-22T10:31:00.000Z"
    }
  ],
  coachAbout: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä...", // string - –æ–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–Ω–µ—Ä–∞
  coachContact: "@sophya_tennis",     // string - –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏
  coachHidden: false,                 // boolean - —Å–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
  
  // –°–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è
  updatedAt: Timestamp                // Firestore Timestamp
}
```

### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è —Ç—Ä–µ–Ω–µ—Ä–æ–≤:

1. **`isCoach: true`** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –∫–∞–∫ —Ç—Ä–µ–Ω–µ—Ä–∞
2. **`coachHidden: false`** –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—è - –ø—Ä–æ—Ñ–∏–ª—å –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
3. **`coachName`** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∏–º—è —Ç—Ä–µ–Ω–µ—Ä–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –≥—Ä—É–ø–ø
4. **`coachMedia`** - –º–∞—Å—Å–∏–≤ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞ –≤ —à—Ç–æ—Ä–∫–µ —Ç—Ä–µ–Ω–µ—Ä–∞
   - **`publicUrl`** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω, –∏–Ω–∞—á–µ –º–µ–¥–∏–∞ –Ω–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è
   - `fileId` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è Telegram –±–æ—Ç–∞
   - `type` –º–æ–∂–µ—Ç –±—ã—Ç—å `"photo"` –∏–ª–∏ `"video"`
5. **`coachContact`** - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∑–∞–Ω—è—Ç–∏–µ

### –°–≤—è–∑—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏ —Ç—Ä–µ–Ω–µ—Ä–æ–≤

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–≤—è–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–æ–ª—é `trainerName` –∏–∑ `groupTrainings` –∏ `coachName` –∏–∑ `users`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–º–µ–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Ç–æ—á–Ω–æ!

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ –æ–±–µ–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π
- –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (`isActive: true`) –∏ –Ω–µ —Å–∫—Ä—ã—Ç—ã–µ —Ç—Ä–µ–Ω–µ—Ä—ã (`coachHidden != true`)
- –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å —Ç—Ä–µ–Ω–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ `groupTrainings`
- –î–∞–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (`createdAt`)